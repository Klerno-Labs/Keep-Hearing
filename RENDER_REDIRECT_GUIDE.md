# Complete Redirect to Render Deployment

This guide helps you transition everything from local development to your live Render deployment.

## Your Render URLs

After your deployment completes, you'll have these URLs:

- **Web Application**: `https://keephearing-web.onrender.com`
- **Database**: Internal connection (automatically configured)

## Step 1: Verify Deployment Status

Go to your Render dashboard: https://dashboard.render.com/

Check that both services are running:
- ‚úÖ `keephearing-db` (PostgreSQL) - Status: Available
- ‚úÖ `keephearing-web` (Web Service) - Status: Live

## Step 2: Update Environment Variables

In your Render web service dashboard, ensure these are set:

### Required Variables:
```
NEXTAUTH_URL=https://keephearing-web.onrender.com
NEXTAUTH_SECRET=<auto-generated by Render>
DATABASE_URL=<auto-linked from database>
NODE_ENV=production
```

### Optional (Add When Ready):
```
RESEND_API_KEY=<your-resend-key>
```

## Step 3: Run Database Setup

In your Render web service, click **"Shell"** tab and run:

### A. Deploy Migrations
```bash
npx prisma migrate deploy
```

This creates all database tables based on your schema.

### B. Create Admin User
```bash
node -e "
const { PrismaClient } = require('@prisma/client');
const bcrypt = require('bcryptjs');
const prisma = new PrismaClient();

async function createAdmin() {
  try {
    const hashedPassword = await bcrypt.hash('ChangeThisPassword123!', 10);
    const admin = await prisma.user.create({
      data: {
        email: 'admin@keephearing.org',
        name: 'Admin User',
        password: hashedPassword,
        role: 'SUPERADMIN'
      }
    });
    console.log('‚úÖ Admin user created:', admin.email);
  } catch (error) {
    console.error('Error:', error.message);
  } finally {
    await prisma.\$disconnect();
  }
}

createAdmin();
"
```

**IMPORTANT**: Replace `ChangeThisPassword123!` with a strong password!

## Step 4: Test Your Live Site

Visit your Render URL: `https://keephearing-web.onrender.com`

### Test These Pages:
- ‚úÖ Homepage: `/`
- ‚úÖ About: `/about`
- ‚úÖ Learn: `/learn`
- ‚úÖ Participate: `/participate`
- ‚úÖ Contact: `/contact`
- ‚úÖ Sign In: `/signin`
- ‚úÖ Admin Panel: `/admin` (use credentials from Step 3B)

### Test Functionality:
1. **Contact Form** (without email):
   - Fill out contact form
   - Should save to database
   - Check in Admin Panel ‚Üí Contact Submissions

2. **Admin Login**:
   - Go to `/signin`
   - Enter admin credentials
   - Access `/admin` dashboard

3. **User Management**:
   - In Admin Panel, try creating a new user
   - Verify it appears in user list

## Step 5: Set Up Custom Domain (Optional)

If you want `keephearing.org` instead of `keephearing-web.onrender.com`:

### A. In Render Dashboard:
1. Go to your web service
2. Click **"Settings"** ‚Üí **"Custom Domain"**
3. Click **"Add Custom Domain"**
4. Enter: `keephearing.org` and `www.keephearing.org`

### B. Configure DNS (At Your Domain Registrar):

Add these records:

**For Root Domain (keephearing.org):**
```
Type: CNAME
Name: @
Value: keephearing-web.onrender.com
TTL: 3600
```

**For WWW Subdomain:**
```
Type: CNAME
Name: www
Value: keephearing-web.onrender.com
TTL: 3600
```

### C. Update NEXTAUTH_URL:

After DNS propagates (~10-60 minutes), update in Render:
```
NEXTAUTH_URL=https://keephearing.org
```

And redeploy.

## Step 6: Enable Email Notifications (Optional)

To enable the contact form email functionality:

### A. Sign Up for Resend:
1. Go to https://resend.com
2. Create free account (100 emails/day)
3. Verify your domain (or use their testing domain)
4. Get your API key

### B. Add to Render:
```
RESEND_API_KEY=re_your_actual_key_here
```

### C. Update Email Addresses:

In your code, search for `info@keephearing.org` and update to your actual email.

## Step 7: Monitor Your Deployment

### Logs:
- View real-time logs in Render dashboard
- Click on your web service ‚Üí **"Logs"** tab

### Metrics:
- Check **"Metrics"** tab for:
  - CPU usage
  - Memory usage
  - Request count
  - Response times

### Alerts:
Set up alerts in Render for:
- Service downtime
- High error rates
- Performance issues

## Step 8: Free Tier Limitations

Be aware of Render's free tier limits:

### Web Service:
- ‚è±Ô∏è Spins down after 15 minutes of inactivity
- üïê Takes ~30 seconds to spin up on first request
- üìÖ 750 hours/month (enough for one 24/7 service)

### Database:
- üíæ 1 GB storage
- üìä 90-day data retention
- üîÑ Daily automatic backups

### Solutions for Spin-Down:
1. Use a monitoring service (UptimeRobot) to ping your site every 10 min
2. Upgrade to Starter plan ($7/month) for no spin-down
3. Accept the 30-second delay on first load

## Step 9: Performance Optimization

### A. Set Up CDN (Cloudflare - Free):
1. Add your domain to Cloudflare
2. Update nameservers at domain registrar
3. Enable caching and optimization features

### B. Image Optimization:
Images are already configured to use Next.js Image optimization.

### C. Database Indexing:
Your Prisma schema already has indexes on commonly queried fields.

## Step 10: Security Checklist

- ‚úÖ HTTPS enabled (automatic with Render)
- ‚úÖ Environment variables secured (not in code)
- ‚úÖ Rate limiting configured (contact form)
- ‚úÖ SQL injection protection (Prisma)
- ‚úÖ XSS protection (Next.js built-in)
- ‚úÖ CSRF protection (NextAuth)
- ‚ö†Ô∏è Change default admin password!
- ‚ö†Ô∏è Add your own NEXTAUTH_SECRET in production

## Troubleshooting

### Site Won't Load:
1. Check Render service status
2. View logs for errors
3. Verify DATABASE_URL is set
4. Ensure migrations ran successfully

### Database Connection Failed:
```bash
# In Render Shell, test connection:
npx prisma db pull
```

### Admin Login Not Working:
1. Verify admin user was created (check logs)
2. Try creating user again
3. Check NEXTAUTH_URL matches your actual URL
4. Clear browser cookies

### Contact Form Not Working:
- Without RESEND_API_KEY: Submissions save to database only
- Check Admin Panel ‚Üí Contact Submissions
- With RESEND_API_KEY: Check Resend dashboard for delivery status

### Build Failures:
- Check build logs in Render
- Verify all TypeScript errors are fixed
- Ensure package.json dependencies are correct

## Maintenance Tasks

### Weekly:
- Check error logs in Render dashboard
- Monitor database storage usage
- Review contact form submissions

### Monthly:
- Check for dependency updates: `npm outdated`
- Review and update security patches
- Backup important data

### As Needed:
- Update content pages
- Add new features
- Scale to paid plan if needed

## Going Production Ready

When you're ready to handle real traffic:

### 1. Upgrade Services:
- **Web Service**: Starter ($7/mo) or Standard ($25/mo)
- **Database**: Standard ($7/mo) for more storage

### 2. Enable Monitoring:
- Set up Sentry for error tracking
- Use Vercel Analytics (already installed)
- Configure uptime monitoring

### 3. Set Up Backups:
- Enable manual database exports
- Store backups securely off-site
- Test restore procedures

### 4. Legal/Compliance:
- Privacy Policy is ready (update with specifics)
- Terms of Service is ready (review with lawyer)
- Cookie Consent is implemented
- GDPR compliance features included

## Support & Resources

- **Render Docs**: https://render.com/docs
- **Render Community**: https://community.render.com
- **Next.js Docs**: https://nextjs.org/docs
- **Prisma Docs**: https://www.prisma.io/docs

---

## Quick Command Reference

### View Logs:
```bash
# In Render dashboard, click "Logs" tab
```

### Run Migrations:
```bash
npx prisma migrate deploy
```

### Generate Prisma Client:
```bash
npx prisma generate
```

### Check Database:
```bash
npx prisma studio
```

### Create User:
```bash
# Use the script from Step 3B above
```

---

**Congratulations! Your Keep Hearing Initiative is now live on Render!** üéâ

Remember to:
1. ‚úÖ Change default admin password
2. ‚úÖ Set up custom domain
3. ‚úÖ Configure email service
4. ‚úÖ Monitor your deployment
5. ‚úÖ Celebrate your launch! üöÄ
